---
import { humanize } from "@/lib/utils/textConverter";
import {
  normalizePathname,
  removeBasePath,
  withBasePath,
} from "@/lib/utils/basePath";

const { className }: { className?: string } = Astro.props;

const relativePath = removeBasePath(Astro.url.pathname);
const paths =
  relativePath === "/"
    ? []
    : relativePath
        .split("/")
        .map((segment) => segment.trim())
        .filter((segment) => segment);
const currentPath = normalizePathname(Astro.url.pathname);
const homeHref = withBasePath();
let parts = [
  {
    label: "Home",
    href: homeHref,
    "aria-label":
      currentPath === normalizePathname(homeHref) ? "page" : undefined,
  },
];

paths.forEach((label: string, i: number) => {
  const href = withBasePath(paths.slice(0, i + 1).join("/"));
  label !== "page" &&
    parts.push({
      label: humanize(label.replace(".html", "").replace(/[-_]/g, " ")) || "",
      href,
      "aria-label":
        currentPath === normalizePathname(href) ? "page" : undefined,
    });
});
---

<nav aria-label="Breadcrumb" class={className}>
  <ol class="inline-flex" role="list">
    {
      parts.map(({ label, ...attrs }, index) => (
        <li class="mx-1 capitalize" role="listitem">
          {index > 0 && <span class="inlin-block mr-1">/</span>}
          {index !== parts.length - 1 ? (
            <a class="text-primary dark:text-darkmode-primary" {...attrs}>
              {label}
            </a>
          ) : (
            <span class="text-text-light dark:text-darkmode-text-light">
              {label}
            </span>
          )}
        </li>
      ))
    }
  </ol>
</nav>
